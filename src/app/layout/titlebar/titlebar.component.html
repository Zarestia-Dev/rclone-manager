<div class="title-bar" data-tauri-drag-region>
  <div class="left-section">
    <!-- Main Buttons -->
    <button
      matIconButton
      [cdkMenuTriggerFor]="addRemoteMenu"
      [attr.aria-label]="'titlebar.addRemoteMenu' | translate"
      data-tauri-drag-region="false"
    >
      <mat-icon svgIcon="plus" aria-hidden="true"></mat-icon>
    </button>

    <button
      matIconButton
      (click)="resetRemote()"
      [attr.aria-label]="'titlebar.home' | translate"
      data-tauri-drag-region="false"
    >
      <mat-icon svgIcon="rclone" aria-hidden="true"></mat-icon>
    </button>

    <!-- Connection Status Indicator -->
    @if (connectionService.status() === 'offline' || connectionService.status() === 'checking') {
      <button
        matIconButton
        (click)="connectionService.runInternetCheck()"
        [disabled]="connectionService.status() === 'checking'"
        [attr.aria-label]="'titlebar.internetStatus' | translate"
        matTooltip="{{ getInternetStatusTooltip() }}"
        data-tauri-drag-region="false"
      >
        @if (connectionService.status() !== 'checking') {
          <mat-icon svgIcon="no-internet" aria-hidden="true"> </mat-icon>
        }
        @if (connectionService.status() === 'checking') {
          <mat-progress-spinner
            class="accent"
            diameter="24"
            mode="indeterminate"
            strokeWidth="4"
            aria-hidden="true"
          >
          </mat-progress-spinner>
        }
      </button>
    }
  </div>

  <div class="right-section">
    <!-- App Menu -->
    <button
      matIconButton
      [cdkMenuTriggerFor]="menu"
      [attr.aria-label]="'titlebar.appMenu' | translate"
      class="menu-button"
      [matBadge]="restartRequired() || updateAvailable() || rcloneUpdateAvailable() ? '!' : null"
      [matBadgeColor]="restartRequired() ? 'warn' : 'primary'"
      matBadgePosition="below before"
      matBadgeSize="small"
      [matTooltip]="updateTooltip()"
      data-tauri-drag-region="false"
    >
      <mat-icon svgIcon="menu-bar" aria-hidden="true"></mat-icon>
    </button>

    <!-- Window Controls -->
    @if (windowButtons) {
      @for (control of windowControls(); track control.label) {
        <button
          matIconButton
          (click)="control.action()"
          [attr.aria-label]="control.label | translate"
          [class]="control.class || ''"
          data-tauri-drag-region="false"
        >
          <mat-icon [svgIcon]="control.icon" aria-hidden="true"></mat-icon>
        </button>
      }
    }
  </div>
</div>

<!-- App Menu Content -->
<ng-template #menu>
  <div cdkMenu class="material-context-menu">
    <!-- Theme Selector -->
    <div
      class="theme-selector"
      [attr.aria-label]="'titlebar.menu.theme' | translate"
      data-tauri-drag-region="false"
    >
      @for (theme of themes; track theme.id) {
        <button
          class="theme-button"
          [class]="theme.class"
          [class.selected]="currentTheme() === theme.id"
          (click)="setTheme(theme.id, $event)"
          [attr.aria-label]="theme.label | translate"
        >
          @if (currentTheme() === theme.id) {
            <mat-icon
              [svgIcon]="theme.icon"
              class="checkmark"
              [class.accent]="theme.id === 'system'"
              aria-hidden="true"
            ></mat-icon>
          }
        </button>
      }
    </div>
    <!-- Settings Actions -->
    @for (item of menuItems; track item.label) {
      @if (item.divider) {
        <mat-divider></mat-divider>
      }
      <button
        cdkMenuItem
        class="menu-item"
        (click)="item.action()"
        [attr.aria-label]="item.label | translate"
      >
        <span>{{ item.label | translate }}</span>
        <span class="shortcut" aria-hidden="true">{{ item.shortcut }}</span>
      </button>
      @if (item.dividerAfter) {
        <mat-divider></mat-divider>
      }
    }

    <button
      cdkMenuItem
      class="menu-item"
      [matTooltip]="updateTooltip()"
      (click)="openAboutModal()"
      [attr.aria-label]="'titlebar.menu.about' | translate"
    >
      <span>{{ 'titlebar.menu.about' | translate }}</span>
      @if (restartRequired() || updateAvailable() || rcloneUpdateAvailable()) {
        <span
          [matBadge]="aboutMenuBadge()"
          matBadgePosition="below before"
          matBadgeSize="small"
        ></span>
      }
    </button>
  </div>
</ng-template>

<!-- Add Remote Menu -->
<ng-template #addRemoteMenu>
  <div cdkMenu class="material-context-menu" xPosition="before">
    @for (item of addRemoteMenuItems; track item.label) {
      <button
        cdkMenuItem
        class="menu-item"
        (click)="item.action()"
        [attr.aria-label]="item.label | translate"
      >
        <span>{{ item.label | translate }}</span>
        <span class="shortcut" aria-hidden="true">{{ item.shortcut }}</span>
      </button>
    }
  </div>
</ng-template>
