<div class="title-bar" data-tauri-drag-region>
  <div class="left-section">
    <!-- Main Buttons -->
    <button matIconButton [cdkMenuTriggerFor]="addRemoteMenu" aria-label="Add remote menu">
      <mat-icon svgIcon="add" aria-hidden="true"></mat-icon>
    </button>

    <button matIconButton (click)="resetRemote()" aria-label="Home">
      <mat-icon svgIcon="rclone-symbolic" aria-hidden="true"></mat-icon>
    </button>

    <!-- Connection Status Indicator -->
    @if (connectionStatus === 'offline' || connectionStatus === 'checking') {
      <button
        matIconButton
        (click)="runInternetCheck()"
        [disabled]="connectionStatus === 'checking'"
        aria-label="Internet connection status"
        matTooltip="{{ getInternetStatusTooltip() }}"
      >
        @if (connectionStatus !== 'checking') {
          <mat-icon svgIcon="no-internet" aria-hidden="true"> </mat-icon>
        }
        @if (connectionStatus === 'checking') {
          <mat-progress-spinner
            class="accent"
            diameter="24"
            mode="indeterminate"
            strokeWidth="4"
            aria-hidden="true"
          >
          </mat-progress-spinner>
        }
      </button>
    }
  </div>

  <div class="right-section">
    <!-- App Menu -->
    <button
      matIconButton
      [cdkMenuTriggerFor]="menu"
      aria-label="Application menu"
      class="menu-button"
      [matBadge]="restartRequired || updateAvailable || rcloneUpdateAvailable ? '!' : null"
      [matBadgeColor]="restartRequired ? 'warn' : 'primary'"
      matBadgePosition="below before"
      matBadgeSize="small"
      [matTooltip]="getUpdateTooltip()"
    >
      <mat-icon svgIcon="menu-bar" aria-hidden="true"></mat-icon>
    </button>

    <!-- Window Controls -->
    @if (windowButtons) {
      <button matIconButton (click)="minimizeWindow()" aria-label="Minimize window">
        <mat-icon svgIcon="remove" aria-hidden="true"></mat-icon>
      </button>
      <button matIconButton (click)="maximizeWindow()" aria-label="Maximize window">
        <mat-icon svgIcon="check-box" aria-hidden="true"></mat-icon>
      </button>
      <button matIconButton (click)="closeWindow()" aria-label="Close window" class="close-button">
        <mat-icon svgIcon="close" aria-hidden="true"></mat-icon>
      </button>
    }
  </div>
</div>

<!-- App Menu Content -->
<ng-template #menu>
  <div cdkMenu class="material-context-menu">
    <!-- Theme Selector -->
    <div class="theme-selector" aria-label="Theme selection">
      <button
        class="theme-button system"
        [class.selected]="(currentTheme$ | async) === 'system'"
        (click)="setTheme('system', $event)"
        aria-label="System theme"
      >
        @if ((currentTheme$ | async) === 'system') {
          <mat-icon svgIcon="circle-check" class="checkmark" aria-hidden="true"></mat-icon>
        }
      </button>

      <button
        class="theme-button light"
        [class.selected]="(currentTheme$ | async) === 'light'"
        (click)="setTheme('light', $event)"
        aria-label="Light theme"
      >
        @if ((currentTheme$ | async) === 'light') {
          <mat-icon svgIcon="circle-check" class="checkmark" aria-hidden="true"></mat-icon>
        }
      </button>

      <button
        class="theme-button dark"
        [class.selected]="(currentTheme$ | async) === 'dark'"
        (click)="setTheme('dark', $event)"
        aria-label="Dark theme"
      >
        @if ((currentTheme$ | async) === 'dark') {
          <mat-icon svgIcon="circle-check" class="checkmark" aria-hidden="true"></mat-icon>
        }
      </button>
    </div>

    <mat-divider></mat-divider>

    <!-- Settings Actions -->
    <button cdkMenuItem class="menu-item" (click)="restoreSettings()" aria-label="Import settings">
      <span>Import</span>
      <span class="shortcut" aria-hidden="true">Ctrl + I</span>
    </button>

    <button cdkMenuItem class="menu-item" (click)="openExportModal()" aria-label="Export settings">
      <span>Export</span>
      <span class="shortcut" aria-hidden="true">Ctrl + E</span>
    </button>

    <mat-divider></mat-divider>

    <!-- Preferences -->
    <button
      cdkMenuItem
      class="menu-item"
      (click)="openPreferencesModal()"
      aria-label="Open preferences"
    >
      <span>Preferences</span>
      <span class="shortcut" aria-hidden="true">Ctrl + ,</span>
    </button>

    <button
      cdkMenuItem
      class="menu-item"
      (click)="openRcloneConfigModal()"
      aria-label="Open RClone configuration"
    >
      <span>Configuration</span>
      <span class="shortcut" aria-hidden="true">Ctrl + .</span>
    </button>

    <mat-divider></mat-divider>
    <button cdkMenuItem class="menu-item" (click)="onBrowseClick()">
      <span>File Browser</span>
      <span class="shortcut" aria-hidden="true">Ctrl + F</span>
    </button>
    <mat-divider></mat-divider>

    <button
      cdkMenuItem
      class="menu-item"
      (click)="openKeyboardShortcutsModal()"
      aria-label="View keyboard shortcuts"
    >
      <span>Keyboard Shortcuts</span>
      <span class="shortcut" aria-hidden="true">Ctrl + ?</span>
    </button>

    <mat-divider></mat-divider>

    <button
      cdkMenuItem
      class="menu-item"
      [matTooltip]="getAboutMenuTooltip()"
      (click)="openAboutModal()"
      aria-label="About application"
    >
      <span>About RClone Manager</span>
      @if (restartRequired || updateAvailable || rcloneUpdateAvailable) {
        <span
          [matBadge]="getAboutMenuBadge()"
          matBadgePosition="below before"
          matBadgeSize="small"
        ></span>
      }
    </button>
  </div>
</ng-template>

<!-- Add Remote Menu -->
<ng-template #addRemoteMenu>
  <div cdkMenu class="material-context-menu" xPosition="before">
    <button
      cdkMenuItem
      class="menu-item"
      (click)="openQuickAddRemoteModal()"
      aria-label="Quick add remote"
    >
      <span>Quick Remote</span>
      <span class="shortcut" aria-hidden="true">Ctrl + R</span>
    </button>
    <button
      cdkMenuItem
      class="menu-item"
      (click)="openRemoteConfigModal()"
      aria-label="Detailed remote configuration"
    >
      <span>Detailed Remote</span>
      <span class="shortcut" aria-hidden="true">Ctrl + N</span>
    </button>
    <button
      cdkMenuItem
      class="menu-item"
      (click)="openRemoteConfigTerminal()"
      aria-label="Open remote configuration in terminal"
    >
      <span>Terminal Remote</span>
      <span class="shortcut" aria-hidden="true">Ctrl + T</span>
    </button>
  </div>
</ng-template>
