:host {
  // Terminal specific (always dark for readability)
  --terminal-bg: #1e1e1e;
  --terminal-line-hover: #2a2d2e;
  --terminal-text: #cccccc;
}

.log-modal-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--app-background);
  color: var(--app-text-color);
  border-radius: var(--modal-radius);
  overflow: hidden;

  // --- Toolbar ---
  .toolbar-section {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-md);
    padding: var(--space-md);
    background: var(--app-background);
    border-bottom: 1px solid var(--border-color);
    align-items: center;
    flex-shrink: 0;

    .filter-controls {
      display: flex;
      flex: 1;
      gap: var(--space-sm);
      min-width: 280px;

      ::ng-deep .mat-mdc-form-field-subscript-wrapper {
        display: none;
      }

      .compact {
        font-size: var(--font-size-md);
      }
    }

    .action-controls {
      display: flex;
      align-items: center;
      gap: 4px;

      .divider {
        width: 1px;
        height: 24px;
        background: var(--border-color);
        margin: 0 8px;
      }

      .warn-btn {
        color: var(--warn-color);
        &:hover {
          background: rgba(var(--warn-color-rgb), 0.1);
        }
      }

      .spinning {
        animation: spin 1s linear infinite;
      }
    }
  }

  // --- Terminal Area ---
  .terminal-viewport {
    flex: 1;
    background: var(--terminal-bg); // Always dark for terminal feel
    overflow: hidden;
    display: flex;
    flex-direction: column;

    .log-scroller {
      flex: 1;
      overflow-y: auto;
      padding: 4px 0;
    }

    // Overlays
    .status-overlay {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: rgba(255, 255, 255, 0.5);
      gap: var(--space-sm);

      mat-icon {
        width: 48px;
        height: 48px;
        opacity: 0.3;
      }
      p {
        font-weight: 500;
      }
      span {
        font-size: var(--font-size-sm);
        opacity: 0.7;
      }
    }
  }
}

// --- Log Entry Styling ---
.log-entry {
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  font-family: monospace;
  font-size: var(--font-size-sm);
  line-height: 1.5;

  // 1. Header Row
  .log-header {
    display: flex;
    align-items: center;
    padding: 6px 12px;
    gap: 12px;
    transition: var(--transition-fast);
    color: var(--terminal-text);

    &:hover {
      background: var(--terminal-line-hover);
      .actions-hover {
        opacity: 1;
      }
    }

    .timestamp {
      color: #569cd6; // VS Code Blue
      min-width: 85px;
      opacity: 0.8;
    }

    .level-tag {
      font-size: var(--font-size-sm);
      font-weight: 600;
      padding: 1px 6px;
      border-radius: 2px;
      min-width: 45px;
      text-align: center;
    }

    .message {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      opacity: 0.9;
    }

    .actions-hover {
      opacity: 0; // Hidden until hover
      display: flex;
      align-items: center;
      gap: 4px;
      transition: opacity 0.2s;

      mat-icon {
        font-size: var(--font-size-base);
        width: 16px;
        height: 16px;
        color: #888;

        &:hover {
          color: white;
        }
      }

      .expand-icon {
        width: 16px;
        height: 16px;
        font-size: var(--font-size-base);
        color: #888;
        margin-left: 4px;
        transition: transform 0.2s;
      }
    }
  }

  // 2. Expanded Body
  .log-body {
    background: rgba(0, 0, 0, 0.3);
    padding: 12px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);

    .detail-block {
      margin-bottom: 16px;
      &:last-child {
        margin-bottom: 0;
      }

      .block-label {
        font-size: var(--font-size-sm);
        text-transform: uppercase;
        color: #666;
        font-weight: 600;
        margin-bottom: 6px;
        letter-spacing: 0.5px;
      }

      .code-block {
        background: #111;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 12px;
        overflow-x: auto;
        color: #d4d4d4;
        white-space: pre-wrap;
        word-break: break-all;

        &.json-theme {
          color: #ce9178;
        } // VS Code string color

        pre {
          margin: 0;
          font-family: inherit;
        }
      }
    }
  }

  &.error {
    .level-tag {
      color: var(--warn-color);
      background: rgba(var(--warn-color-rgb), 0.15);
    }
    .message {
      color: var(--warn-color);
    }
    &.expanded .log-header {
      border-left: 3px solid var(--warn-color);
      background: rgba(var(--warn-color-rgb), 0.05);
    }
  }

  &.warn {
    .level-tag {
      color: var(--orange);
      background: rgba(var(--orange-rgb), 0.15);
    }
    .message {
      color: var(--orange);
    }
    &.expanded .log-header {
      border-left: 3px solid var(--orange);
      background: rgba(var(--orange-rgb), 0.05);
    }
  }

  &.info {
    .level-tag {
      color: var(--accent-color);
      background: rgba(var(--accent-color-rgb), 0.15);
    }
    &.expanded .log-header {
      border-left: 3px solid var(--accent-color);
      background: rgba(var(--accent-color-rgb), 0.05);
    }
  }

  &.debug {
    .level-tag {
      color: #9e9e9e;
      background: rgba(158, 158, 158, 0.15);
    }
    .message {
      color: #bdbdbd;
    }
    &.expanded .log-header {
      border-left: 3px solid #9e9e9e;
      background: rgba(158, 158, 158, 0.05);
    }
  }
}

// --- Mobile Adjustments ---
@media (max-width: 600px) {
  .toolbar-section {
    flex-direction: column;
    align-items: stretch;

    .filter-controls {
      flex-direction: column;

      .level-select {
        width: 100% !important;
      }
    }

    .action-controls {
      justify-content: flex-end;
      border-top: 1px solid var(--border-color);
      padding-top: 8px;
      margin-top: 8px;
    }
  }
}
