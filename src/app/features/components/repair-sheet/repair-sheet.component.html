<mat-nav-list class="repair-sheet" [class.repairing]="installing()">
  <div class="sheet-header">
    <div class="repair-header-top">
      <div class="repair-icon">
        <mat-icon [svgIcon]="repairIcon()"></mat-icon>
      </div>

      <div class="repair-content">
        <h3>{{ displayTitle() }}</h3>
        <p>{{ displayMessage() }}</p>
      </div>
    </div>

    @if (repairDetails(); as details) {
      <div class="repair-details">
        @for (detail of details; track $index) {
          <div class="detail-item">
            <mat-icon svgIcon="{{ detail.icon }}"></mat-icon>
            <span>
              <strong>{{ detail.labelKey | translate }}:</strong>
              {{ detail.valueKey | translate }}
            </span>
          </div>
        }
      </div>
    }

    @if (requiresPassword()) {
      <div class="password-row">
        <app-password-manager
          [password]="password()"
          [storePassword]="storePassword()"
          [isSubmitting]="isSubmittingPassword()"
          [hasError]="hasPasswordError()"
          [errorMessage]="passwordErrorMessage()"
          [showStoreOption]="!!data.showStoreOption"
          [disabled]="installing() || showConfigOptions()"
          (passwordChange)="password.set($event)"
          (storePasswordChange)="storePassword.set($event)"
          (unlock)="submitPassword()"
        ></app-password-manager>
      </div>

      <div class="config-toggle-container">
        <button
          matButton="filled"
          class="accent"
          (click)="toggleConfigOptions()"
          [disabled]="installing() || isSubmittingPassword()"
        >
          <mat-icon svgIcon="caret-down" [class.rotated]="showConfigOptions()"></mat-icon>
          {{
            (showConfigOptions()
              ? 'repairSheet.hideConfigOptions'
              : 'repairSheet.useDifferentConfig'
            ) | translate
          }}
        </button>
      </div>

      @if (showConfigOptions()) {
        <app-installation-options
          [mode]="'config'"
          [tabOptions]="configTabOptions"
          [disabled]="installing()"
          (dataChange)="onInstallationOptionsChange($event)"
          (validChange)="onInstallationValidChange($event)"
        >
        </app-installation-options>
      }
    }

    @if (isRclonePathRepair()) {
      <div>
        <button
          matButton="filled"
          class="accent"
          (click)="toggleInstallOptions()"
          [disabled]="installing()"
        >
          <mat-icon svgIcon="caret-down" [class.rotated]="showAdvanced()"></mat-icon>
          {{
            (showAdvanced() ? 'repairSheet.hideAdvanced' : 'repairSheet.showAdvanced') | translate
          }}
        </button>
      </div>

      @if (showAdvanced()) {
        <app-installation-options
          [mode]="'install'"
          [disabled]="installing()"
          (dataChange)="onInstallationOptionsChange($event)"
          (validChange)="onInstallationValidChange($event)"
        >
        </app-installation-options>
      }
    }
  </div>

  <div class="sheet-actions">
    <button
      matButton="filled"
      [disabled]="!canRepair()"
      (click)="repair()"
      [attr.aria-label]="
        (installing() ? 'repairSheet.repairingAria' : 'repairSheet.startRepairAria') | translate
      "
      [matTooltip]="repairTooltip() ? (repairTooltip() | translate) : ''"
    >
      {{
        installing() || isSubmittingPassword()
          ? isSubmittingPassword()
            ? ('repairSheet.validatingPassword' | translate)
            : (repairProgressTextKey() | translate)
          : (repairButtonTextKey() | translate)
      }}
      <mat-icon
        [svgIcon]="repairButtonIcon()"
        [class.animate-spin]="installing() || isSubmittingPassword()"
      ></mat-icon>
    </button>
  </div>
</mat-nav-list>
