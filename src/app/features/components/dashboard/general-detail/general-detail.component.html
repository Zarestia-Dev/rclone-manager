<div class="remote-details">
  <div class="detail-header">
    <div class="header-content">
      <div class="remote-info-section">
        <div class="icon-container">
          <mat-icon
            [svgIcon]="iconService.getIconName(selectedRemote().remoteSpecs.type)"
            class="remote-type-icon"
          ></mat-icon>
        </div>
        <div class="remote-text-info">
          <h2 class="remote-name" matTooltip="{{ selectedRemote().remoteSpecs.name }}">
            {{ selectedRemote().remoteSpecs.name }}
          </h2>
          <span class="remote-type">{{ selectedRemote().remoteSpecs.type | titlecase }}</span>
        </div>
      </div>
      <div
        class="remote-status-indicators"
        role="group"
        [attr.aria-label]="'dashboard.generalDetail.remoteActionQuickSelection' | translate"
      >
        @for (actionConfig of actionConfigs; track trackByActionKey($index, actionConfig)) {
          <div
            class="status-chip"
            [class]="actionConfig.key"
            [class.selected]="isActionSelected(actionConfig.key)"
            [class.active]="isActionActive(actionConfig.key)"
            [class.disabled]="!isActionSelected(actionConfig.key) && !canSelectMoreActions()"
            role="button"
            tabindex="0"
            [attr.aria-pressed]="isActionSelected(actionConfig.key)"
            [attr.aria-label]="getAriaLabel(actionConfig.key)"
            [matTooltip]="getActionTooltip(actionConfig.key)"
            (click)="onToggleAction(actionConfig.key)"
            (keydown.enter)="onToggleAction(actionConfig.key)"
            (keydown.space)="onToggleAction(actionConfig.key)"
          >
            <div class="status-dot">
              <mat-icon [svgIcon]="actionConfig.icon"></mat-icon>
            </div>

            @if (isActionSelected(actionConfig.key)) {
              <span class="selection-badge" aria-hidden="true">
                {{ getActionPosition(actionConfig.key) }}
              </span>
            }

            <span class="status-label">{{ actionConfig.label | translate }}</span>

            @if (isActionSelected(actionConfig.key)) {
              <span class="cdk-visually-hidden">
                {{ getAriaLabel(actionConfig.key) }}
              </span>
            }
          </div>
        }
      </div>
    </div>
  </div>

  <div class="detail-content">
    <app-disk-usage-panel [config]="diskUsageConfig()"></app-disk-usage-panel>

    <app-jobs-panel
      [config]="jobsPanelConfig()"
      (stopJob)="
        stopJob.emit({
          type: $event.type,
          remoteName: $event.remoteName,
          profileName: $event.profileName,
        })
      "
      (deleteJob)="deleteJob.emit($event)"
    >
    </app-jobs-panel>

    @if (hasScheduledTasks()) {
      <mat-card class="scheduled-tasks-card">
        <mat-card-header>
          <mat-card-title>
            <div class="panel-title">
              <mat-icon svgIcon="clock"></mat-icon>
              <span>{{ 'dashboard.generalDetail.scheduledTasks' | translate }}</span>
              <span class="task-counter"
                >{{ currentTaskCardIndex() + 1 }} / {{ remoteScheduledTasks().length }}</span
              >
            </div>
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          @if (remoteScheduledTasks().length > 1) {
            <div class="carousel-indicators">
              @for (
                task of remoteScheduledTasks();
                track trackByTaskId($index, task);
                let i = $index
              ) {
                <div
                  class="indicator"
                  [class.active]="i === currentTaskCardIndex()"
                  (click)="goToTaskCard(i)"
                  [matTooltip]="task.name"
                  role="button"
                  tabindex="0"
                  [attr.aria-label]="
                    'dashboard.generalDetail.goToTask' | translate: { index: i + 1 }
                  "
                ></div>
              }
            </div>
          }

          <div class="task-carousel-container">
            <div class="task-carousel-slide-wrapper">
              @if (currentTask(); as task) {
                <mat-card
                  class="task-detail-card"
                  [class.disabled]="task.status === 'disabled'"
                  [class.stopping]="task.status === 'stopping'"
                >
                  <mat-card-header class="task-detail-header">
                    <div class="task-info">
                      <div class="task-title-row">
                        <mat-icon
                          [svgIcon]="getTaskTypeIcon(task.taskType)"
                          class="task-type-icon"
                          [class.sync-color]="task.taskType === 'sync'"
                          [class.copy-color]="task.taskType === 'copy'"
                          [class.move-color]="task.taskType === 'move'"
                          [class.bisync-color]="task.taskType === 'bisync'"
                        ></mat-icon>
                        <h4>{{ task.name }}</h4>
                        <span
                          class="task-status-badge"
                          [ngClass]="task.status"
                          [matTooltip]="getTaskStatusTooltip(task.status) | translate"
                        >
                          {{ 'task.status.' + task.status | translate }}
                        </span>
                      </div>
                      <p class="task-type-label">
                        {{ task.taskType | titlecase }}
                        {{ 'dashboard.generalDetail.operation' | translate }}
                      </p>
                    </div>
                    <button
                      mat-icon-button
                      (click)="toggleScheduledTask(task.id)"
                      [matTooltip]="getToggleTooltip(task.status) | translate"
                      [disabled]="task.status === 'stopping'"
                    >
                      <mat-icon [svgIcon]="getToggleIcon(task.status)"></mat-icon>
                    </button>
                  </mat-card-header>

                  <mat-card-footer class="task-detail-body">
                    <div class="detail-section">
                      <h5 class="section-title">
                        <mat-icon svgIcon="clock"></mat-icon>
                        {{ 'dashboard.generalDetail.schedule' | translate }}
                      </h5>
                      <div class="detail-grid">
                        <div class="detail-item">
                          <span class="label">{{
                            'dashboard.generalDetail.cronExpression' | translate
                          }}</span>
                          <span class="value cron-expression">{{ task.cronExpression }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="label">{{
                            'dashboard.generalDetail.nextRunLabel' | translate
                          }}</span>
                          <span class="value highlight">{{ getFormattedNextRun(task) }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="label">{{
                            'dashboard.generalDetail.lastRunLabel' | translate
                          }}</span>
                          <span class="value">{{ getFormattedLastRun(task) }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="label">{{
                            'dashboard.generalDetail.createdLabel' | translate
                          }}</span>
                          <span class="value">{{ task.createdAt | date: 'medium' }}</span>
                        </div>
                      </div>
                    </div>

                    <div class="detail-section">
                      <h5 class="section-title">
                        <mat-icon svgIcon="chart"></mat-icon>
                        {{ 'dashboard.generalDetail.statistics' | translate }}
                      </h5>
                      <div class="stats-grid">
                        <div class="stat-card success">
                          <div class="stat-value">{{ task.successCount }}</div>
                          <div class="stat-label">
                            {{ 'dashboard.generalDetail.successful' | translate }}
                          </div>
                        </div>
                        <div class="stat-card failed">
                          <div class="stat-value">{{ task.failureCount }}</div>
                          <div class="stat-label">
                            {{ 'dashboard.generalDetail.failedCount' | translate }}
                          </div>
                        </div>
                        <div class="stat-card total">
                          <div class="stat-value">{{ task.runCount }}</div>
                          <div class="stat-label">
                            {{ 'dashboard.generalDetail.totalRuns' | translate }}
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="detail-section">
                      <h5 class="section-title">
                        <mat-icon svgIcon="folder"></mat-icon>
                        {{ 'dashboard.generalDetail.paths' | translate }}
                      </h5>
                      <div class="path-grid">
                        <div class="path-item">
                          <span class="path-label">{{
                            'dashboard.generalDetail.sourceLabel' | translate
                          }}</span>
                          <code class="path-value">{{
                            task.args['source'] || task.args['remote_name'] + ':'
                          }}</code>
                        </div>
                        <div class="path-item">
                          <span class="path-label">{{
                            'dashboard.generalDetail.destinationLabel' | translate
                          }}</span>
                          <code class="path-value">{{ task.args['dest'] }}</code>
                        </div>
                      </div>
                    </div>

                    @if (task.lastError) {
                      <div class="detail-section error-section">
                        <h5 class="section-title">
                          <mat-icon svgIcon="circle-exclamation" class="error-icon"></mat-icon>
                          {{ 'dashboard.generalDetail.lastError' | translate }}
                        </h5>
                        <div class="error-message">
                          {{ task.lastError }}
                        </div>
                      </div>
                    }

                    @if (task.currentJobId) {
                      <div class="detail-section running-section">
                        <h5 class="section-title">
                          <mat-icon svgIcon="play" class="running-icon"></mat-icon>
                          {{ 'dashboard.generalDetail.currentlyRunning' | translate }}
                        </h5>
                        <div class="running-info">
                          {{ 'dashboard.generalDetail.jobIdLabel' | translate }}
                          {{ task.currentJobId }}
                        </div>
                      </div>
                    }
                  </mat-card-footer>
                </mat-card>
              }
            </div>
          </div>
          @if (remoteScheduledTasks().length > 1) {
            <div class="carousel-navigation">
              <button
                mat-icon-button
                (click)="previousTaskCard()"
                [disabled]="currentTaskCardIndex() === 0"
                [matTooltip]="'dashboard.generalDetail.previousTaskTooltip' | translate"
                class="nav-button"
              >
                <mat-icon svgIcon="left-arrow"></mat-icon>
              </button>
              <button
                mat-icon-button
                (click)="nextTaskCard()"
                [disabled]="currentTaskCardIndex() === remoteScheduledTasks().length - 1"
                [matTooltip]="'dashboard.generalDetail.nextTaskTooltip' | translate"
                class="nav-button"
              >
                <mat-icon svgIcon="right-arrow"></mat-icon>
              </button>
            </div>
          }
        </mat-card-content>
      </mat-card>
    }

    <app-settings-panel
      [config]="remoteConfigurationPanelConfig()"
      (editSettings)="onEditRemoteConfiguration()"
    >
    </app-settings-panel>
  </div>
</div>
