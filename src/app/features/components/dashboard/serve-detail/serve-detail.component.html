<div class="serve-detail">
  <div class="detail-header">
    <div class="header-content">
      <div class="remote-info-section">
        <div class="icon-container">
          <mat-icon
            [svgIcon]="iconService.getIconName(selectedRemote.remoteSpecs.type)"
            class="remote-type-icon"
          ></mat-icon>
        </div>
        <div class="remote-text-info">
          <h2 class="remote-name" matTooltip="{{ selectedRemote.remoteSpecs.name }}">
            {{ selectedRemote.remoteSpecs.name }}
          </h2>
          <span class="remote-type">{{ selectedRemote.remoteSpecs.type | titlecase }}</span>
        </div>
      </div>
    </div>
    <div class="header-divider"></div>
  </div>

  <div class="detail-content">
    <div class="serves-section">
      <h3 class="section-title">
        <mat-icon svgIcon="satellite-dish"></mat-icon>
        <span>Active Serves</span>
        @if (remoteServes.length > 0) {
          <span class="serves-count">{{ remoteServes.length }}</span>
        }
      </h3>

      @if (remoteServes.length === 0) {
        <mat-card class="empty-state-card">
          <mat-card-content>
            <div class="empty-state">
              <mat-icon svgIcon="satellite-dish" class="empty-icon"></mat-icon>
              <h4>No Active Serves</h4>
              <p>
                This remote is not currently being served via any network protocol. Click "Start
                Serve" to make it accessible over HTTP, WebDAV, FTP, SFTP, or other protocols.
              </p>
            </div>
          </mat-card-content>
        </mat-card>
      } @else {
        <div class="serves-grid">
          @for (serve of remoteServes; track serve.id) {
            <mat-card class="serve-card">
              <mat-card-content>
                <div class="serve-card-header">
                  <div class="serve-info">
                    <div class="serve-icon-wrapper">
                      <mat-icon
                        [svgIcon]="getServeTypeInfo(serve.params.type).icon"
                        class="serve-icon"
                      ></mat-icon>
                    </div>
                    <div class="serve-details">
                      <div class="serve-title-row">
                        <span class="serve-protocol-badge">
                          {{ serve.params.type | uppercase }}
                        </span>
                      </div>

                      @if (getServeUrl(serve); as url) {
                        <div class="serve-url-container">
                          <span
                            class="serve-url copyable-text"
                            matTooltip="Click to copy URL"
                            (click)="copyToClipboard(url, 'URL Copied!')"
                            role="button"
                            tabindex="0"
                          >
                            {{ url }}
                          </span>
                        </div>
                      } @else {
                        <span class="serve-address">{{ serve.addr }}</span>
                      }
                      <span class="serve-fs">{{ serve.params.fs }}</span>
                    </div>
                  </div>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="stopServe(serve)"
                    matTooltip="Stop this serve"
                    class="stop-btn"
                  >
                    <mat-icon svgIcon="stop"></mat-icon>
                  </button>
                </div>

                <div class="serve-metadata">
                  <div class="metadata-row">
                    <mat-icon svgIcon="fingerprint" class="metadata-icon"></mat-icon>
                    <span class="metadata-label">ID:</span>
                    <span
                      class="metadata-value copyable-text"
                      matTooltip="Click to copy ID"
                      (click)="copyToClipboard(serve.id, 'ID Copied!')"
                      role="button"
                      tabindex="1"
                    >
                      {{ serve.id }}
                    </span>
                  </div>

                  @if (getOptionKeys(serve.params).length > 0) {
                    <div class="metadata-row">
                      <mat-icon svgIcon="gear" class="metadata-icon"></mat-icon>
                      <span class="metadata-label">Options:</span>
                      <span
                        class="metadata-value options-value"
                        [matTooltip]="getOptionsTooltip(serve.params)"
                        matTooltipClass="pre-line-tooltip"
                      >
                        {{ getOptionKeys(serve.params).length }} active
                      </span>
                    </div>
                  }
                </div>
              </mat-card-content>
            </mat-card>
          }
        </div>
      }
      <button
        matButton="filled"
        color="primary"
        (click)="onStartServeClick()"
        class="start-serve-btn"
      >
        <mat-icon svgIcon="play"></mat-icon>
        <span>Start Serve</span>
      </button>
    </div>

    <mat-divider></mat-divider>

    <div class="settings-layout">
      <section class="settings-group">
        <header class="group-header">
          <h3 class="group-title">Serve Configuration</h3>
          <p class="group-description">
            Configure how files are served from this remote over network protocols.
          </p>
        </header>
        <div class="group-panels">
          @for (section of SERVE_SECTIONS; track section.key) {
            <app-settings-panel
              [config]="getSettingsPanelConfig(section)"
              (editSettings)="onEditSettings($event)"
            ></app-settings-panel>
          }
        </div>
      </section>

      <section class="settings-group">
        <header class="group-header">
          <h3 class="group-title">Advanced Settings</h3>
          <p class="group-description">
            Additional filtering, VFS, and backend options for serve operations.
          </p>
        </header>
        <div class="group-panels">
          @for (section of ADVANCED_SECTIONS; track section.key) {
            <app-settings-panel
              [config]="getSettingsPanelConfig(section)"
              (editSettings)="onEditSettings($event)"
            ></app-settings-panel>
          }
        </div>
      </section>
    </div>
  </div>
</div>
