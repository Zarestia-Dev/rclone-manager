<!-- app-overview.component.html -->
<div
  class="app-overview"
  [ngClass]="mode()"
  animate.enter="fade-in-out-enter"
  animate.leave="fade-in-out-leave"
>
  <!-- Header Section -->
  <app-overview-header [mode]="mode()"></app-overview-header>

  <div class="overview-content">
    <!-- Status Overview Panel -->
    <app-status-overview-panel
      [mode]="mode()"
      [totalCount]="remotes().length"
      [activeCount]="activeCount()"
      [inactiveCount]="inactiveCount()"
    >
    </app-status-overview-panel>

    <!-- Active Remotes Panel (Standard: mount/sync) -->
    @if (activeCount() > 0 && mode() !== 'serve') {
      <app-remotes-panel
        [title]="getActiveTitle()"
        [icon]="activeIcon()"
        [remotes]="activeRemotes()"
        [mode]="mode()"
        [actionInProgress]="actionInProgress()"
        [primaryActionLabel]="primaryActionLabel()"
        [activeIcon]="activeIcon()"
        (remoteSelected)="selectRemote($event)"
        (openInFiles)="triggerOpenInFiles($event)"
        (startJob)="startJob.emit({ type: $event.type, remoteName: $event.remoteName })"
        (stopJob)="stopJob.emit({ type: $event.type, remoteName: $event.remoteName })"
      >
      </app-remotes-panel>
    }

    <!-- Active Serves Panel (Serve mode: show individual serve cards) -->
    @if (activeCount() > 0 && mode() === 'serve') {
      <mat-card class="remotes-panel active-remotes-panel">
        <mat-card-header class="remotes-header">
          <mat-card-title class="panel-title-content">
            <mat-icon [svgIcon]="activeIcon()" class="active-icon"></mat-icon>
            <span>{{ getActiveTitle() }}</span>
            <span class="remote-count">{{ runningServes().length }}</span>
          </mat-card-title>
        </mat-card-header>

        <mat-card-content class="remotes-content">
          <div class="remotes-grid">
            @for (serve of runningServes(); track serve.id) {
              <app-serve-card
                [serve]="serve"
                [showRemoteName]="true"
                (stopServe)="
                  stopJob.emit({
                    type: 'serve',
                    serveId: $event.id,
                    remoteName: $event.params.fs.split(':')[0],
                  })
                "
                (copyToClipboard)="handleCopyToClipboard($event)"
                (cardClick)="handleServeCardClick($event)"
              >
              </app-serve-card>
            }
          </div>
        </mat-card-content>
      </mat-card>
    }

    <!-- Inactive Remotes Panel -->
    @if (inactiveCount() > 0) {
      <app-remotes-panel
        [title]="getInactiveTitle()"
        [icon]="'circle-xmark'"
        [remotes]="inactiveRemotes()"
        [mode]="mode()"
        [actionInProgress]="actionInProgress()"
        [primaryActionLabel]="primaryActionLabel()"
        [activeIcon]="activeIcon()"
        (remoteSelected)="selectRemote($event)"
        (openInFiles)="triggerOpenInFiles($event)"
        (startJob)="startJob.emit({ type: $event.type, remoteName: $event.remoteName })"
        (stopJob)="stopJob.emit({ type: $event.type, remoteName: $event.remoteName })"
      >
      </app-remotes-panel>
    }
  </div>
</div>
