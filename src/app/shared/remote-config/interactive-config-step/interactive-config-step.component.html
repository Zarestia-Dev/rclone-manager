<div class="interactive-container">
  <!-- Enhanced Header with Progress Indicator -->
  <div class="step-header">
    <div class="header-content">
      <div class="icon-container">
        <mat-icon class="step-icon" svgIcon="gear"></mat-icon>
      </div>
      <div class="header-text">
        <h3 class="step-title">{{ 'wizards.remoteConfig.additionalConfig' | translate }}</h3>
        <p class="step-subtitle">{{ 'wizards.remoteConfig.setupSubtitle' | translate }}</p>
      </div>
    </div>
  </div>

  <!-- Question Content Card -->
  <div class="question-content" aria-live="polite" role="main">
    <!-- Question Display Card -->
    <div class="question-card">
      <div class="question-header">
        <mat-icon class="question-icon" svgIcon="question"></mat-icon>
        <div class="question-title-section">
          <h4 class="question-title">
            {{ question()?.Option?.Name || ('wizards.remoteConfig.configRequired' | translate) }}
            @if (isFieldRequired()) {
              <span class="required-badge">{{
                'wizards.remoteConfig.requiredBadge' | translate
              }}</span>
            }
          </h4>
        </div>
      </div>
      <div class="question-text">
        <p
          class="help-text"
          [innerHTML]="
            (question()?.Option?.Help | linebreaks) ||
            ('wizards.remoteConfig.nextQuestionHelp' | translate)
          "
        ></p>
        @if (question()?.Option?.DefaultStr) {
          <div class="default-info">
            <mat-icon class="info-icon" svgIcon="circle-info"></mat-icon>
            <span
              >{{ 'wizards.remoteConfig.defaultValue' | translate }}
              <strong>{{ question()?.Option?.DefaultStr }}</strong></span
            >
          </div>
        }
      </div>
    </div>

    <!-- Input Section -->
    @if (question(); as q) {
      <div class="input-section">
        @switch (q.Option?.Type) {
          <!-- Enhanced Boolean Toggle -->
          @case ('bool') {
            <div class="input-card bool-input">
              <div class="toggle-container">
                <mat-slide-toggle
                  [(ngModel)]="answer"
                  [disabled]="canceling()"
                  class="toggle-input primary"
                  [attr.aria-label]="q.Option?.Name || 'Toggle option'"
                >
                  <span class="toggle-label">{{
                    answer
                      ? ('wizards.remoteConfig.yes' | translate)
                      : ('wizards.remoteConfig.no' | translate)
                  }}</span>
                </mat-slide-toggle>
              </div>
            </div>
          }
          <!-- Enhanced Select and Text Inputs -->
          @default {
            @if (q.Option?.Examples?.length) {
              <div class="input-card select-input">
                <mat-form-field appearance="fill">
                  <mat-label>{{
                    q.Option?.Name || ('wizards.remoteConfig.chooseOption' | translate)
                  }}</mat-label>
                  <mat-select
                    [ngModel]="selectedIndex()"
                    (ngModelChange)="onSelectionChange($event)"
                    [disabled]="canceling()"
                    [attr.aria-label]="
                      q.Option?.Name || ('wizards.remoteConfig.selectOption' | translate)
                    "
                  >
                    <mat-select-trigger>
                      {{ getDisplayValue(selectedIndex(), q.Option?.Examples) }}
                    </mat-select-trigger>
                    @for (ex of q.Option?.Examples; track index; let index = $index) {
                      <mat-option [value]="index">
                        <div class="option-content">
                          <span class="option-label">{{ ex.Help || ex.Value }} </span>
                          @if (ex.Help && ex.Help !== ex.Value) {
                            <span class="option-secondary">{{ ex.Value }}</span>
                          }
                        </div>
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
            } @else {
              <div class="input-card text-input">
                <mat-form-field appearance="fill">
                  <mat-label>{{
                    q.Option?.Name || ('wizards.remoteConfig.enterValue' | translate)
                  }}</mat-label>
                  <input
                    matInput
                    [(ngModel)]="answer"
                    [disabled]="canceling()"
                    [placeholder]="inputPlaceholder()"
                    [attr.aria-label]="
                      q.Option?.Name || ('wizards.remoteConfig.inputField' | translate)
                    "
                  />
                  @if (isFieldRequired() && !answer) {
                    <mat-error>{{ 'wizards.remoteConfig.fieldRequired' | translate }}</mat-error>
                  }
                </mat-form-field>
              </div>
            }
          }
        }
      </div>
    }

    @if (isFieldRequired()) {
      <div class="validation-status">
        <mat-icon
          class="validation-icon"
          [svgIcon]="isValidAnswer() ? 'circle-check' : 'info'"
          [class.valid]="isValidAnswer()"
          [class.invalid]="!isValidAnswer()"
        ></mat-icon>
        <span class="validation-text">
          {{
            isValidAnswer()
              ? ('wizards.remoteConfig.readyToContinue' | translate)
              : ('wizards.remoteConfig.provideValue' | translate)
          }}
        </span>
      </div>
    }
  </div>
</div>
