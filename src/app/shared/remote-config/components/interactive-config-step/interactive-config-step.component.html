<div class="interactive-container">
  <!-- Enhanced Header with Progress Indicator -->
  <div class="step-header">
    <div class="header-content">
      <div class="icon-container">
        <mat-icon class="step-icon" svgIcon="gear"></mat-icon>
      </div>
      <div class="header-text">
        <h3 class="step-title">Additional Configuration</h3>
        <p class="step-subtitle">Complete the setup for this remote</p>
      </div>
      @if (!canceling) {
        <div class="progress-indicator">
          <div class="progress-dot active"></div>
        </div>
      }
    </div>
  </div>

  <!-- Question Content Card -->
  <div class="question-content" aria-live="polite" role="main">
    <!-- Question Display Card -->
    <div class="question-card">
      <div class="question-header">
        <mat-icon class="question-icon" svgIcon="question"></mat-icon>
        <div class="question-title-section">
          <h4 class="question-title">{{ question?.Option?.Name || 'Configuration Required' }}</h4>
          @if (question?.Option?.Required) {
            <span class="required-badge">Required</span>
          }
        </div>
      </div>
      <div class="question-text">
        <p
          class="help-text"
          [innerText]="question?.Option?.Help || 'Answer the next question to continue.'"
        ></p>
        @if (question?.Option?.DefaultStr) {
          <div class="default-info">
            <mat-icon class="info-icon" svgIcon="circle-info"></mat-icon>
            <span
              >Default value: <strong>{{ question?.Option?.DefaultStr }}</strong></span
            >
          </div>
        }
      </div>
    </div>

    <!-- Input Section -->
    @if (question; as q) {
      <div class="input-section">
        @switch (q.Option?.Type) {
          <!-- Enhanced Boolean Toggle -->
          @case ('bool') {
            <div class="input-card bool-input">
              <div class="toggle-container">
                <mat-slide-toggle
                  [(ngModel)]="answer"
                  [disabled]="canceling"
                  class="toggle-input primary"
                  [attr.aria-label]="q.Option?.Name || 'Toggle option'"
                >
                  <span class="toggle-label">{{ answer ? 'Yes' : 'No' }}</span>
                </mat-slide-toggle>
              </div>
            </div>
          }
          <!-- Enhanced Select and Text Inputs -->
          @default {
            @if (q.Option?.Examples?.length) {
              <div class="input-card select-input">
                <mat-form-field appearance="outline" class="input-field">
                  <mat-label>{{ q.Option?.Name || 'Choose an option' }}</mat-label>
                  <mat-select
                    [(ngModel)]="answer"
                    [disabled]="canceling"
                    [attr.aria-label]="q.Option?.Name || 'Select option'"
                  >
                    @for (ex of q.Option?.Examples; track trackByIndex($index, ex)) {
                      <mat-option [value]="ex.Value">
                        <div class="option-content">
                          <span class="option-value">{{ ex.Help || ex.Value }} </span>
                          @if (ex.Help && ex.Help !== ex.Value) {
                            <span class="option-hint">{{ ex.Value }}</span>
                          }
                        </div>
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
            } @else {
              <div class="input-card text-input">
                <mat-form-field appearance="outline" class="input-field">
                  <mat-label>{{ q.Option?.Name || 'Enter value' }}</mat-label>
                  <input
                    matInput
                    [(ngModel)]="answer"
                    [disabled]="canceling"
                    [placeholder]="getInputPlaceholder(q)"
                    [attr.aria-label]="q.Option?.Name || 'Input field'"
                  />
                  @if (isFieldRequired() && !answer) {
                    <mat-error>This field is required</mat-error>
                  }
                </mat-form-field>
              </div>
            }
          }
        }
      </div>
    }

    <!-- Enhanced Actions Section -->
    <div class="actions-section">
      @if (question?.Option?.Required) {
        <div class="validation-status">
          <mat-icon
            class="validation-icon"
            [svgIcon]="isValidAnswer() ? 'circle-check' : 'info'"
            [class.valid]="isValidAnswer()"
            [class.invalid]="!isValidAnswer()"
          ></mat-icon>
          <span class="validation-text">
            {{ isValidAnswer() ? 'Ready to continue' : 'Please provide a value' }}
          </span>
        </div>
      }

      <div class="actions">
        <button
          matButton="filled"
          (click)="onContinue()"
          [disabled]="isButtonDisabled()"
          class="continue-button"
          [class.loading]="canceling || processing"
          [attr.aria-label]="canceling || processing ? 'Processing...' : 'Continue to next step'"
        >
          <span>{{ canceling || processing ? 'Processing...' : 'Continue' }}</span>
        </button>
      </div>
    </div>
  </div>
</div>
